# 回路表比对工具 - 使用说明

## 概述

本工具用于比较两份Excel回路表，根据第2列的回路号进行整行比较，并在新文件的第一列填写变更标记。

## 功能特性

1. **自动比对**: 根据第2列（回路号）作为关键字段进行比对
2. **变更标记**: 在新文件第一列添加变更标记
   - ✓ 新增（绿色背景）：只在新文件中存在的回路
   - ★ 变更（黄色背景）：在新旧文件中都存在，但内容有差异
   - 空白：未变更的记录
3. **详细变更信息**: 变更的记录会显示具体哪些列发生了变化（格式：列X:旧值→新值）
4. **统计信息**: 显示新增、删除、变更和未变更的记录数量

## 使用方法

### 方法一：使用Python脚本（推荐）

1. 确保已安装Python和openpyxl库：
   ```bash
   pip install openpyxl
   ```

2. 将两份Excel文件（OLD.xlsx和NEW.xlsx）放入`比对`文件夹

3. 运行比对脚本：
   ```bash
   python circuit_compare.py
   ```

4. 查看比对结果：
   - 控制台会显示比对统计信息
   - 结果文件保存在 `比对/NEW_已标注.xlsx`

### 方法二：使用批处理文件

1. 双击运行 `run_compare.bat`
2. 等待脚本执行完成
3. 查看输出结果和生成的文件

## 数据要求

- 文件格式：.xlsx 或 .xls
- 第2列必须是唯一的回路号/线号
- 从第4行开始读取数据（前3行为表头）
- 两份文件的列数应保持一致

## 输出说明

### 变更标记
- **新增记录**: 第一列显示"✓ 新增"，背景为绿色
- **变更记录**: 第一列显示"★ 变更: 列X:旧值→新值; 列Y:旧值→新值"，背景为黄色
- **未变更记录**: 第一列为空白

### 删除记录
删除的记录只在控制台输出中显示，不会在新文件中标记（因为删除的记录不存在于新文件中）

### 统计信息
比对完成后会显示：
- 新增：X 条
- 删除：X 条
- 变更：X 条
- 未变更：X 条
- 总计：X 条（新文件）

## 注意事项

1. 确保两份Excel文件的路径正确（`比对/OLD.xlsx` 和 `比对/NEW.xlsx`）
2. 第2列的回路号不能为空且不能有重复
3. 如果文件正在被其他程序打开，可能会导致保存失败
4. 建议在比对前备份原始文件

## 故障排除

### 问题：运行脚本时提示找不到openpyxl
**解决方法**：安装openpyxl库
```bash
pip install openpyxl
```

### 问题：提示找不到Excel文件
**解决方法**：确保OLD.xlsx和NEW.xlsx文件存在于`比对`文件夹中

### 问题：文件保存失败
**解决方法**：
1. 检查文件是否被其他程序打开
2. 检查是否有写入权限
3. 关闭Excel后重试

## 脚本说明

### circuit_compare.py（主脚本）
主比对脚本，功能完整，可以直接运行。

### analyze_circuits.py（详细版本）
包含详细的日志输出和数据结构分析。

### simple_check.py（测试脚本）
用于测试环境配置和文件读取是否正常。

## 示例输出

```
回路表比对工具
============================================================
加载旧文件: 比对/OLD.xlsx
  旧文件: 100 行 x 10 列
加载新文件: 比对/NEW.xlsx
  新文件: 105 行 x 10 列
旧文件读取了 97 条记录

比对结果:
============================================================
新增: 8 条
删除: 0 条
变更: 3 条
未变更: 94 条
总计: 105 条

结果已保存到: 比对/NEW_已标注.xlsx
============================================================
比对完成！
```

## 技术支持

如有问题，请检查：
1. Python版本（建议3.6+）
2. openpyxl库是否正确安装
3. Excel文件格式是否正确
4. 文件路径是否正确
