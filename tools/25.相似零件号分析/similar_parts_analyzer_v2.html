<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›¸ä¼¼é›¶ä»¶å·åˆ†æå·¥å…· V2</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        // å¦‚æœä¸»CDNå¤±è´¥ï¼Œå°è¯•å¤‡ç”¨CDN
        if (typeof XLSX === 'undefined') {
            var script = document.createElement('script');
            script.src = 'https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js';
            document.head.appendChild(script);
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .upload-section {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 40px;
            margin-bottom: 20px;
        }

        .upload-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .file-input-group {
            margin-bottom: 20px;
        }

        .file-input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .file-status {
            margin-top: 10px;
            padding: 10px;
            background: #d4edda;
            border-radius: 4px;
            display: none;
        }

        .file-status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            text-align: center;
            display: none;
            margin: 20px 0;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-section {
            display: none;
        }

        .export-btn {
            background: #28a745;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .export-btn:hover {
            background: #218838;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 14px;
            opacity: 0.9;
        }

        .part-group {
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }

        .part-group-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .part-group-header:hover {
            background: linear-gradient(135deg, #5568d3 0%, #653a8b 100%);
        }

        .part-group-content {
            display: none;
            padding: 20px;
        }

        .part-group-content.active {
            display: block;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: left;
        }

        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
            position: sticky;
            top: 0;
        }

        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .comparison-table tr:hover {
            background: #e9ecef;
        }

        .diff-item {
            background: #d4edda;
            padding: 3px 8px;
            margin: 2px 0;
            border-radius: 3px;
        }

        .diff-item.remove {
            background: #f8d7da;
        }

        .arrow-down::after {
            content: ' â–¼';
        }

        .arrow-up::after {
            content: ' â–²';
        }

        .filter-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç›¸ä¼¼é›¶ä»¶å·åˆ†æå·¥å…· V2</h1>

        <div class="upload-section">
            <div class="file-input-group">
                <h3>ğŸ“ æ–‡ä»¶1: Master Listï¼ˆç”¨äºåˆ†æï¼‰</h3>
                <p style="color: #666; margin-bottom: 10px;">ä¸Šä¼ åŒ…å«æ‰€æœ‰é›¶ä»¶é…ç½®çš„ä¸»åˆ—è¡¨æ–‡ä»¶</p>
                <button class="btn" onclick="document.getElementById('fileInput1').click()">é€‰æ‹©Master Listæ–‡ä»¶</button>
                <input type="file" id="fileInput1" accept=".xlsx,.xls" onchange="handleFile1(event)">
                <div id="status1" class="file-status"></div>
            </div>

            <div class="file-input-group">
                <h3>ğŸ“‹ æ–‡ä»¶2: é›¶ä»¶å·åˆ—è¡¨ï¼ˆç”¨äºç­›é€‰ï¼‰</h3>
                <p style="color: #666; margin-bottom: 10px;">ä¸Šä¼ åŒ…å«ç›®æ ‡é›¶ä»¶å·çš„æ–‡ä»¶ï¼ˆå¦‚ï¼šT28 MYå‚ç›´åˆ‡æ¢é›¶ä»¶å·0119.xlsxï¼‰</p>
                <p style="color: #666; font-size: 14px; margin-bottom: 10px;">å°†ä»æ–‡ä»¶çš„<strong>ç¬¬1ä¸ªSheetçš„Aåˆ—</strong>æå–é›¶ä»¶å·</p>
                <button class="btn" onclick="document.getElementById('fileInput2').click()">é€‰æ‹©é›¶ä»¶å·åˆ—è¡¨æ–‡ä»¶</button>
                <input type="file" id="fileInput2" accept=".xlsx,.xls" onchange="handleFile2(event)">
                <div id="status2" class="file-status"></div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" id="analyzeBtn" onclick="startAnalysis()" disabled>å¼€å§‹åˆ†æ</button>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨åˆ†ææ•°æ®ï¼Œè¯·ç¨å€™...</p>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="stats" id="stats"></div>
            <div class="filter-info" id="filterInfo"></div>
            <button class="export-btn" onclick="exportToExcel()">ğŸ“¥ å¯¼å‡ºåˆ†æç»“æœ (Excel)</button>
            <div id="results"></div>
        </div>
    </div>

    <script>
        let masterListData = null;
        let partsListData = [];
        let analysisResults = [];

        function handleFile1(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    masterListData = XLSX.read(data, { type: 'array' });

                    const status = document.getElementById('status1');
                    status.style.display = 'block';
                    status.className = 'file-status';
                    status.innerHTML = `âœ… å·²åŠ è½½: ${file.name}<br>Sheetæ•°é‡: ${masterListData.SheetNames.length}`;

                    checkBothFiles();
                } catch (error) {
                    const status = document.getElementById('status1');
                    status.style.display = 'block';
                    status.className = 'file-status error';
                    status.innerHTML = `âŒ åŠ è½½å¤±è´¥: ${error.message}`;
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function handleFile2(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });

                    // è¯»å–ç¬¬1ä¸ªsheet
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                    // æå–Aåˆ—çš„é›¶ä»¶å·ï¼ˆè·³è¿‡å¯èƒ½çš„è¡¨å¤´ï¼‰
                    partsListData = [];

                    // ä»ç¬¬1è¡Œå¼€å§‹æå–ï¼Œå¦‚æœç¬¬1è¡Œçœ‹èµ·æ¥åƒè¡¨å¤´ï¼ˆåŒ…å«"é›¶ä»¶"ç­‰æ–‡å­—ï¼‰ï¼Œåˆ™ä»ç¬¬2è¡Œå¼€å§‹
                    let startRow = 0;
                    if (jsonData.length > 0 && jsonData[0][0]) {
                        const firstCell = String(jsonData[0][0]).toLowerCase();
                        if (firstCell.includes('é›¶ä»¶') || firstCell.includes('part') || firstCell.includes('å·')) {
                            startRow = 1; // è·³è¿‡è¡¨å¤´
                        }
                    }

                    for (let i = startRow; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row[0]) {
                            const partNumber = String(row[0]).trim();
                            if (partNumber) {
                                partsListData.push(partNumber);
                            }
                        }
                    }

                    // å»é‡
                    partsListData = [...new Set(partsListData)];

                    const status = document.getElementById('status2');
                    status.style.display = 'block';
                    status.className = 'file-status';
                    status.innerHTML = `âœ… å·²åŠ è½½: ${file.name}<br>è¯»å–Sheet: ${sheetName}<br>æå–é›¶ä»¶å·: ${partsListData.length}ä¸ª<br><small>ï¼ˆä»Aåˆ—æå–ï¼Œå·²è‡ªåŠ¨å»é‡ï¼‰</small>`;

                    checkBothFiles();
                } catch (error) {
                    const status = document.getElementById('status2');
                    status.style.display = 'block';
                    status.className = 'file-status error';
                    status.innerHTML = `âŒ åŠ è½½å¤±è´¥: ${error.message}`;
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function checkBothFiles() {
            const btn = document.getElementById('analyzeBtn');
            if (masterListData && partsListData.length > 0) {
                btn.disabled = false;
                btn.textContent = 'å¼€å§‹åˆ†æ';
            }
        }

        function startAnalysis() {
            if (!masterListData || partsListData.length === 0) {
                alert('è¯·å…ˆä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶ï¼');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';

            setTimeout(() => {
                try {
                    analyzeData();
                    displayResults();
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('resultsSection').style.display = 'block';
                } catch (error) {
                    console.error('åˆ†æå‡ºé”™:', error);
                    alert('åˆ†æå¤±è´¥: ' + error.message);
                    document.getElementById('loading').style.display = 'none';
                }
            }, 100);
        }

        function analyzeData() {
            // è·å–Master Listçš„æœ€åä¸€ä¸ªsheet
            const lastSheetName = masterListData.SheetNames[masterListData.SheetNames.length - 1];
            const worksheet = masterListData.Sheets[lastSheetName];
            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

            // è§£ææ•°æ®ç»“æ„ï¼ˆä¸V1ç›¸åŒï¼‰
            const configDescriptions = jsonData[2] || [];
            const allRow = jsonData[3] || [];

            // æ‰¾åˆ°ALLåˆ—çš„ä½ç½®
            let allColIndex = -1;
            for (let i = 0; i < allRow.length; i++) {
                if (allRow[i] === 'ALL') {
                    allColIndex = i;
                    break;
                }
            }

            if (allColIndex === -1) {
                throw new Error('æœªåœ¨ç¬¬4è¡Œæ‰¾åˆ°ALLåˆ—ï¼');
            }

            // æå–é…ç½®é¡¹
            const configItems = [];
            for (let i = allColIndex + 1; i < configDescriptions.length; i++) {
                if (configDescriptions[i]) {
                    configItems.push({
                        index: i,
                        description: configDescriptions[i]
                    });
                }
            }

            // è§£æé›¶ä»¶æ•°æ®
            const parts = [];
            for (let i = 4; i < jsonData.length; i++) {
                const row = jsonData[i];
                if (!row || row.length === 0) continue;

                const partNumber = String(row[0] || '').trim();
                const partName = row[1];
                const partFunction = row[4] || '';

                if (!partNumber) continue;

                const configs = {};
                configItems.forEach(item => {
                    configs[item.description] = row[item.index] === 'â—';
                });

                parts.push({
                    partNumber,
                    partName,
                    partFunction,
                    configs
                });
            }

            // æŒ‰é›¶ä»¶åç§°åˆ†ç»„
            const partsByName = {};
            parts.forEach(part => {
                if (!partsByName[part.partName]) {
                    partsByName[part.partName] = [];
                }
                partsByName[part.partName].push(part);
            });

            // ç­›é€‰ï¼šåªå¤„ç†åœ¨é›¶ä»¶å·åˆ—è¡¨ä¸­çš„é›¶ä»¶
            const targetPartNumbers = new Set(partsListData);

            // ä¸ºæ¯ä¸ªç›®æ ‡é›¶ä»¶æ‰¾æœ€ç›¸ä¼¼çš„4ä¸ªé›¶ä»¶
            analysisResults = [];

            Object.keys(partsByName).forEach(partName => {
                const groupParts = partsByName[partName];

                groupParts.forEach(targetPart => {
                    // åªå¤„ç†åœ¨é›¶ä»¶å·åˆ—è¡¨ä¸­çš„ç›®æ ‡é›¶ä»¶
                    if (!targetPartNumbers.has(targetPart.partNumber)) {
                        return;
                    }

                    // è®¡ç®—ä¸å…¶ä»–é›¶ä»¶çš„ç›¸ä¼¼åº¦
                    const allSimilarities = groupParts
                        .filter(p => p.partNumber !== targetPart.partNumber)
                        .map(otherPart => {
                            const diff = calculateConfigDiff(targetPart.configs, otherPart.configs);
                            return {
                                part: otherPart,
                                diffCount: diff.differences.length,
                                diffDetails: diff
                            };
                        })
                        .sort((a, b) => a.diffCount - b.diffCount)
                        .slice(0, 4);

                    analysisResults.push({
                        targetPart,
                        similarParts: allSimilarities,
                        partName
                    });
                });
            });

            // ç»Ÿè®¡ä¿¡æ¯
            window.statsInfo = {
                totalTargetParts: analysisResults.length,
                totalPartsInList: partsListData.length,
                totalConfigs: configItems.length
            };
        }

        function calculateConfigDiff(configs1, configs2) {
            const allKeys = new Set([...Object.keys(configs1), ...Object.keys(configs2)]);
            const differences = [];

            allKeys.forEach(key => {
                const val1 = configs1[key];
                const val2 = configs2[key];

                if (val1 !== val2) {
                    differences.push({
                        config: key,
                        target: val1,
                        other: val2
                    });
                }
            });

            return {
                differences: differences,
                diffCount: differences.length
            };
        }

        function displayResults() {
            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            const statsHtml = `
                <div class="stat-card">
                    <h3>${window.statsInfo.totalPartsInList}</h3>
                    <p>é›¶ä»¶å·åˆ—è¡¨æ€»æ•°</p>
                </div>
                <div class="stat-card">
                    <h3>${window.statsInfo.totalTargetParts}</h3>
                    <p>æ‰¾åˆ°çš„åŒ¹é…é›¶ä»¶æ•°</p>
                </div>
                <div class="stat-card">
                    <h3>${analysisResults.length}</h3>
                    <p>ç”Ÿæˆåˆ†æç»“æœæ•°</p>
                </div>
            `;
            document.getElementById('stats').innerHTML = statsHtml;

            // æ˜¾ç¤ºç­›é€‰ä¿¡æ¯
            const filterHtml = `
                <strong>ğŸ“‹ ç­›é€‰è¯´æ˜ï¼š</strong><br>
                åªæ˜¾ç¤ºé›¶ä»¶å·åˆ—è¡¨æ–‡ä»¶ï¼ˆç¬¬1ä¸ªSheetçš„Aåˆ—ï¼‰ä¸­åŒ…å«çš„é›¶ä»¶å·çš„åˆ†æç»“æœã€‚
                å…±ä» ${window.statsInfo.totalPartsInList} ä¸ªç›®æ ‡é›¶ä»¶å·ä¸­æ‰¾åˆ° ${window.statsInfo.totalTargetParts} ä¸ªåŒ¹é…é¡¹ã€‚
            `;
            document.getElementById('filterInfo').innerHTML = filterHtml;

            // æ˜¾ç¤ºè¯¦ç»†ç»“æœ
            let resultsHtml = '';

            analysisResults.forEach((result, index) => {
                resultsHtml += `
                    <div class="part-group">
                        <div class="part-group-header arrow-down" onclick="toggleGroup(${index})">
                            <span>é›¶ä»¶å·: ${result.targetPart.partNumber} - ${result.partName}</span>
                            <span>æ‰¾åˆ° ${result.similarParts.length} ä¸ªç›¸ä¼¼é›¶ä»¶</span>
                        </div>
                        <div class="part-group-content active" id="group-${index}">
                `;

                if (result.similarParts.length === 0) {
                    resultsHtml += '<p style="color: #999;">æœªæ‰¾åˆ°ç›¸ä¼¼é›¶ä»¶</p>';
                } else {
                    resultsHtml += '<table class="comparison-table">';
                    resultsHtml += '<thead><tr>';
                    resultsHtml += '<th>æ’å</th>';
                    resultsHtml += '<th>ç›¸ä¼¼é›¶ä»¶å·</th>';
                    resultsHtml += '<th>å·®å¼‚é…ç½®æ•°</th>';
                    resultsHtml += '<th>ç›¸ä¼¼é›¶ä»¶åŠŸèƒ½</th>';
                    resultsHtml += '<th>æ–°å¢åŠŸèƒ½</th>';
                    resultsHtml += '<th>åˆ é™¤åŠŸèƒ½</th>';
                    resultsHtml += '</tr></thead><tbody>';

                    result.similarParts.forEach((similar, simIndex) => {
                        const diffDetails = similar.diffDetails.differences;
                        const partFunction = similar.part.partFunction || 'æ— åŠŸèƒ½æè¿°';

                        // åˆ†ç¦»æ–°å¢å’Œåˆ é™¤çš„åŠŸèƒ½
                        const addedFeatures = [];
                        const removedFeatures = [];

                        diffDetails.forEach(diff => {
                            if (diff.target === false && diff.other === true) {
                                addedFeatures.push(diff.config);
                            } else if (diff.target === true && diff.other === false) {
                                removedFeatures.push(diff.config);
                            }
                        });

                        resultsHtml += '<tr>';
                        resultsHtml += `<td>${simIndex + 1}</td>`;
                        resultsHtml += `<td><strong>${similar.part.partNumber}</strong></td>`;
                        resultsHtml += `<td>${diffDetails.length}</td>`;

                        resultsHtml += '<td>';
                        resultsHtml += `<div style="max-height: 150px; overflow-y: auto; font-size: 12px; word-wrap: break-word;">`;
                        resultsHtml += partFunction;
                        resultsHtml += '</div>';
                        resultsHtml += '</td>';

                        resultsHtml += '<td>';
                        if (addedFeatures.length === 0) {
                            resultsHtml += '<span style="color: #999;">æ— æ–°å¢åŠŸèƒ½</span>';
                        } else {
                            resultsHtml += '<div style="font-size: 12px;">';
                            addedFeatures.forEach(feature => {
                                resultsHtml += `<div class="diff-item"><span style="color: #155724;">+ ${feature}</span></div>`;
                            });
                            resultsHtml += '</div>';
                        }
                        resultsHtml += '</td>';

                        resultsHtml += '<td>';
                        if (removedFeatures.length === 0) {
                            resultsHtml += '<span style="color: #999;">æ— åˆ é™¤åŠŸèƒ½</span>';
                        } else {
                            resultsHtml += '<div style="font-size: 12px;">';
                            removedFeatures.forEach(feature => {
                                resultsHtml += `<div class="diff-item remove"><span style="color: #721c24;">- ${feature}</span></div>`;
                            });
                            resultsHtml += '</div>';
                        }
                        resultsHtml += '</td>';

                        resultsHtml += '</tr>';
                    });

                    resultsHtml += '</tbody></table>';
                }

                resultsHtml += '</div></div>';
            });

            document.getElementById('results').innerHTML = resultsHtml;
        }

        function toggleGroup(index) {
            const content = document.getElementById(`group-${index}`);
            const header = content.previousElementSibling;

            if (content.classList.contains('active')) {
                content.classList.remove('active');
                header.classList.remove('arrow-down');
                header.classList.add('arrow-up');
            } else {
                content.classList.add('active');
                header.classList.remove('arrow-up');
                header.classList.add('arrow-down');
            }
        }

        function exportToExcel() {
            if (analysisResults.length === 0) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®ï¼');
                return;
            }

            const wb = XLSX.utils.book_new();
            const exportData = [];

            analysisResults.forEach(result => {
                result.similarParts.forEach((similar, simIndex) => {
                    const addedFeatures = [];
                    const removedFeatures = [];

                    similar.diffDetails.differences.forEach(diff => {
                        if (diff.target === false && diff.other === true) {
                            addedFeatures.push(diff.config);
                        } else if (diff.target === true && diff.other === false) {
                            removedFeatures.push(diff.config);
                        }
                    });

                    const row = {
                        'ç›®æ ‡é›¶ä»¶å·': result.targetPart.partNumber,
                        'é›¶ä»¶åç§°': result.partName,
                        'ç›¸ä¼¼åº¦æ’å': simIndex + 1,
                        'ç›¸ä¼¼é›¶ä»¶å·': similar.part.partNumber,
                        'å·®å¼‚é…ç½®æ•°': similar.diffDetails.differences.length,
                        'ç›¸ä¼¼é›¶ä»¶åŠŸèƒ½': similar.part.partFunction || '',
                        'æ–°å¢åŠŸèƒ½': addedFeatures.length > 0 ? addedFeatures.join('ã€') : 'æ— æ–°å¢åŠŸèƒ½',
                        'åˆ é™¤åŠŸèƒ½': removedFeatures.length > 0 ? removedFeatures.join('ã€') : 'æ— åˆ é™¤åŠŸèƒ½'
                    };

                    exportData.push(row);
                });
            });

            const ws = XLSX.utils.json_to_sheet(exportData);
            ws['!cols'] = [
                { wch: 20 },
                { wch: 30 },
                { wch: 12 },
                { wch: 20 },
                { wch: 12 },
                { wch: 50 },
                { wch: 50 },
                { wch: 50 }
            ];

            XLSX.utils.book_append_sheet(wb, ws, 'ç­›é€‰åçš„ç›¸ä¼¼é›¶ä»¶åˆ†æ');

            const now = new Date();
            const timestamp = now.toISOString().slice(0, 10).replace(/-/g, '');
            XLSX.writeFile(wb, `ç›¸ä¼¼é›¶ä»¶åˆ†æç»“æœ_V2_${timestamp}.xlsx`);
        }
    </script>
</body>
</html>
