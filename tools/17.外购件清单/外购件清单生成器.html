<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤–è´­ä»¶æ¸…å•ç”Ÿæˆå™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 95vw;
            max-width: 1400px;
            max-height: 95vh;
            margin: 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            overflow-y: auto;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 14px;
        }

        .upload-section {
            margin-bottom: 30px;
        }

        .upload-box {
            border: 3px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s;
            background: #f9f9f9;
            cursor: pointer;
            position: relative;
        }

        .upload-box:hover {
            border-color: #667eea;
            background: #f0f0ff;
        }

        .upload-box.dragover {
            border-color: #667eea;
            background: #e8e8ff;
            transform: scale(1.02);
        }

        .upload-box.has-file {
            border-color: #4caf50;
            background: #f0fff0;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: #667eea;
        }

        .upload-box.has-file .upload-icon {
            color: #4caf50;
        }

        .upload-text {
            color: #666;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .upload-box input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-name {
            color: #4caf50;
            font-weight: bold;
            margin-top: 10px;
            font-size: 14px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .progress-section {
            margin-top: 30px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .status-text {
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        .result-section {
            margin-top: 20px;
            display: none;
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            flex: 1;
            display: none;
            flex-direction: column;
        }

        .result-section.show {
            display: flex;
        }

        .result-section h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .result-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .preview-table {
            width: 100%;
            table-layout: fixed;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            font-size: 12px;
        }

        .preview-table th,
        .preview-table td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
            word-wrap: break-word;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .preview-table th:nth-child(1),
        .preview-table td:nth-child(1) { width: 8%; } /* Wire ID */
        .preview-table th:nth-child(2),
        .preview-table td:nth-child(2) { width: 8%; } /* Multicore ID */
        .preview-table th:nth-child(3),
        .preview-table td:nth-child(3) { width: 15%; } /* Option */
        .preview-table th:nth-child(4),
        .preview-table td:nth-child(4) { width: 6%; } /* Color */
        .preview-table th:nth-child(5),
        .preview-table td:nth-child(5) { width: 7%; } /* Size */
        .preview-table th:nth-child(6),
        .preview-table td:nth-child(6) { width: 7%; } /* Material */
        .preview-table th:nth-child(7),
        .preview-table td:nth-child(7) { width: 7%; } /* Ident Tag */
        .preview-table th:nth-child(8),
        .preview-table td:nth-child(8) { width: 10%; } /* From Code */
        .preview-table th:nth-child(9),
        .preview-table td:nth-child(9) { width: 6%; } /* From Pin */
        .preview-table th:nth-child(10),
        .preview-table td:nth-child(10) { width: 15%; } /* Fromä¸­æ–‡æè¿° */
        .preview-table th:nth-child(11),
        .preview-table td:nth-child(11) { width: 10%; } /* To Code */
        .preview-table th:nth-child(12),
        .preview-table td:nth-child(12) { width: 6%; } /* To Pin */
        .preview-table th:nth-child(13),
        .preview-table td:nth-child(13) { width: 15%; } /* Toä¸­æ–‡æè¿° */

        .preview-table th {
            background: #667eea;
            color: white;
            font-weight: bold;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .preview-table tr:hover {
            background: #f5f5f5;
        }

        .preview-table-container {
            overflow-y: auto;
            overflow-x: hidden;
            flex: 1;
            min-height: 300px;
            max-height: calc(60vh - 150px);
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            margin-top: 10px;
        }

        .success-icon {
            text-align: center;
            font-size: 64px;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ å¤–è´­ä»¶æ¸…å•ç”Ÿæˆå™¨</h1>
        <p class="subtitle">ä¸Šä¼ Wire Listå’ŒConnListæ–‡ä»¶ï¼Œè‡ªåŠ¨ç”Ÿæˆå¤–è´­ä»¶æ¸…å•</p>

        <div class="upload-section">
            <div class="upload-box" id="wirelistBox">
                <input type="file" id="wirelistFile" accept=".xlsx,.xls,.csv" />
                <div class="upload-icon">ğŸ“‹</div>
                <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼  Wire List æ–‡ä»¶</div>
                <div class="file-name" id="wirelistName"></div>
            </div>
        </div>

        <div class="upload-section">
            <div class="upload-box" id="connlistBox">
                <input type="file" id="connlistFile" accept=".xlsx,.xls,.csv" />
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼  ConnList æ–‡ä»¶</div>
                <div class="file-name" id="connlistName"></div>
            </div>
        </div>

        <div class="button-group">
            <button class="btn-primary" id="generateBtn" disabled>
                ç”Ÿæˆå¤–è´­ä»¶æ¸…å•
            </button>
            <button class="btn-secondary" id="resetBtn">
                é‡ç½®
            </button>
        </div>

        <div class="progress-section" id="progressSection">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="status-text" id="statusText">å‡†å¤‡ä¸­...</div>
        </div>

        <div class="result-section" id="resultSection">
            <div class="success-icon">âœ…</div>
            <h3>ç”ŸæˆæˆåŠŸï¼</h3>
            <div class="result-stats">
                <div class="stat-card">
                    <div class="stat-value" id="statTotal">0</div>
                    <div class="stat-label">å¤–è´­ä»¶æ€»æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statC">0</div>
                    <div class="stat-label">Cå¼€å¤´å¤–è´­ä»¶</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statS">0</div>
                    <div class="stat-label">Så¼€å¤´å¤–è´­ä»¶</div>
                </div>
            </div>
            <button class="btn-primary" id="downloadBtn" style="width: 100%;">
                ğŸ“¥ ä¸‹è½½å¤–è´­ä»¶æ¸…å• (Excel)
            </button>
            <h4 style="margin-top: 20px; color: #333;">å®Œæ•´æ•°æ®é¢„è§ˆ</h4>
            <div class="preview-table-container">
                <table class="preview-table" id="previewTable"></table>
            </div>
        </div>
    </div>

    <script>
        let wirelistData = null;
        let connlistData = null;
        let generatedData = null;

        const wirelistBox = document.getElementById('wirelistBox');
        const connlistBox = document.getElementById('connlistBox');
        const wirelistFile = document.getElementById('wirelistFile');
        const connlistFile = document.getElementById('connlistFile');
        const wirelistName = document.getElementById('wirelistName');
        const connlistName = document.getElementById('connlistName');
        const generateBtn = document.getElementById('generateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const progressSection = document.getElementById('progressSection');
        const progressFill = document.getElementById('progressFill');
        const statusText = document.getElementById('statusText');
        const resultSection = document.getElementById('resultSection');
        const downloadBtn = document.getElementById('downloadBtn');

        // æ‹–æ‹½æ•ˆæœ
        function setupDragDrop(box, fileInput, nameDisplay) {
            box.addEventListener('dragover', (e) => {
                e.preventDefault();
                box.classList.add('dragover');
            });

            box.addEventListener('dragleave', () => {
                box.classList.remove('dragover');
            });

            box.addEventListener('drop', (e) => {
                e.preventDefault();
                box.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    handleFileSelect(fileInput, nameDisplay, box);
                }
            });

            fileInput.addEventListener('change', () => {
                handleFileSelect(fileInput, nameDisplay, box);
            });
        }

        function handleFileSelect(input, nameDisplay, box) {
            const file = input.files[0];
            if (file) {
                nameDisplay.textContent = file.name;
                box.classList.add('has-file');
                checkFilesReady();
            }
        }

        setupDragDrop(wirelistBox, wirelistFile, wirelistName);
        setupDragDrop(connlistBox, connlistFile, connlistName);

        function checkFilesReady() {
            const wirelistReady = wirelistFile.files.length > 0;
            const connlistReady = connlistFile.files.length > 0;
            generateBtn.disabled = !(wirelistReady && connlistReady);
        }

        // è¯»å–Excelæ–‡ä»¶
        function readExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array', cellDates: true });
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        resolve(jsonData);
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        // ç”Ÿæˆå¤–è´­ä»¶æ¸…å•
        generateBtn.addEventListener('click', async () => {
            try {
                progressSection.style.display = 'block';
                resultSection.style.display = 'none';
                generateBtn.disabled = true;

                updateProgress(10, 'æ­£åœ¨è¯»å–Wire Listæ–‡ä»¶...');
                wirelistData = await readExcelFile(wirelistFile.files[0]);

                updateProgress(40, 'æ­£åœ¨è¯»å–ConnListæ–‡ä»¶...');
                connlistData = await readExcelFile(connlistFile.files[0]);

                updateProgress(60, 'æ­£åœ¨å¤„ç†æ•°æ®...');

                // å¤„ç†æ•°æ®
                const result = processWireList(wirelistData, connlistData);
                generatedData = result;

                updateProgress(100, 'ç”Ÿæˆå®Œæˆï¼');

                // æ˜¾ç¤ºç»“æœ
                displayResults(result);

                setTimeout(() => {
                    progressSection.style.display = 'none';
                    resultSection.classList.add('show');
                    resultSection.style.display = 'flex';
                    generateBtn.disabled = false;
                }, 500);

            } catch (error) {
                alert('é”™è¯¯ï¼š' + error.message);
                progressSection.style.display = 'none';
                generateBtn.disabled = false;
            }
        });

        function updateProgress(percent, text) {
            progressFill.style.width = percent + '%';
            progressFill.textContent = percent + '%';
            statusText.textContent = text;
        }

        function processWireList(wirelist, connlist) {
            // è§£æWire List
            const wirelistHeader = wirelist[0];
            const colMapping = {};
            wirelistHeader.forEach((header, index) => {
                colMapping[header] = index;
            });

            const multicoreIdCol = colMapping['Multicore ID'];
            const optionCol = colMapping['Option'];
            const wireIdCol = colMapping['Wire ID'];
            const colorCol = colMapping['Color'];
            const sizeCol = colMapping['Size / Gauge'];
            const materialCol = colMapping['Material'];
            const identTagCol = colMapping['Ident Tag'];
            const fromCodeCol = colMapping['From Code'];
            const fromPinCol = colMapping['From Pin'];
            const toCodeCol = colMapping['To Code'];
            const toPinCol = colMapping['To Pin'];

            // è§£æConnListåˆ›å»ºä»£ç åˆ°ä¸­æ–‡çš„æ˜ å°„
            const connMap = {};
            if (connlist && connlist.length > 1) {
                // ConnListç»“æ„ï¼š
                // Row 1: A=British anti-theft alarm, B=çŸ­å·, C=ä¸­æ–‡æè¿°, ...
                // Row 2+: Båˆ—=ä»£ç (å¦‚FTIV), Cåˆ—=ä¸­æ–‡æè¿°(å¦‚1.5T FTIVé˜€)

                // è·³è¿‡ç¬¬ä¸€è¡Œè¡¨å¤´ï¼Œä»ç¬¬äºŒè¡Œå¼€å§‹è¯»å–
                // Båˆ—(ç´¢å¼•1)æ˜¯ä»£ç ï¼ŒCåˆ—(ç´¢å¼•2)æ˜¯ä¸­æ–‡æè¿°
                for (let i = 1; i < connlist.length; i++) {
                    const row = connlist[i];
                    if (row.length >= 3) {
                        const code = row[1]; // Båˆ—
                        const desc = row[2]; // Cåˆ—

                        if (code && code !== 'undefined' && code !== 'null' && desc && desc !== 'undefined' && desc !== 'null') {
                            const codeStr = String(code).trim();
                            const descStr = String(desc).trim();

                            if (codeStr && descStr) {
                                connMap[codeStr] = descStr;
                            }
                        }
                    }
                }

                console.log('ConnListæ˜ å°„å»ºç«‹å®Œæˆï¼Œå…±', Object.keys(connMap).length, 'æ¡');
                console.log('å‰10ä¸ªæ˜ å°„ç¤ºä¾‹:', Object.entries(connMap).slice(0, 10));
            }

            // ç­›é€‰å¤–è´­ä»¶å›è·¯ï¼ˆæ¯æ ¹å›è·¯å•ç‹¬ä¸€è¡Œï¼‰
            const wireList = [];
            let cCount = 0;
            let sCount = 0;

            for (let i = 1; i < wirelist.length; i++) {
                const row = wirelist[i];
                const multicoreId = row[multicoreIdCol];

                if (multicoreId && (multicoreId.startsWith('C') || multicoreId.startsWith('S'))) {
                    const wireData = {
                        wireId: row[wireIdCol] || '',
                        multicoreId: multicoreId,
                        option: row[optionCol] || '',
                        color: row[colorCol] || '',
                        size: row[sizeCol] || '',
                        material: row[materialCol] || '',
                        identTag: row[identTagCol] || '',
                        fromCode: row[fromCodeCol] || '',
                        fromPin: row[fromPinCol] || '',
                        toCode: row[toCodeCol] || '',
                        toPin: row[toPinCol] || ''
                    };

                    wireList.push(wireData);

                    if (multicoreId.startsWith('C')) cCount++;
                    if (multicoreId.startsWith('S')) sCount++;
                }
            }

            // ç”Ÿæˆè¾“å‡ºæ•°æ®ï¼ˆæ¯æ ¹å›è·¯ä¸€è¡Œï¼‰
            const output = [];
            output.push([
                'Wire ID',
                'Multicore ID',
                'Option',
                'Color',
                'Size / Gauge',
                'Material',
                'Ident Tag',
                'From Code',
                'From Pin',
                'Fromä¸­æ–‡æè¿°',
                'To Code',
                'To Pin',
                'Toä¸­æ–‡æè¿°'
            ]);

            // æŒ‰Multicore IDå’ŒWire IDæ’åº
            wireList.sort((a, b) => {
                if (a.multicoreId !== b.multicoreId) {
                    return a.multicoreId.localeCompare(b.multicoreId);
                }
                return (a.wireId || '').localeCompare(b.wireId || '');
            });

            wireList.forEach(wire => {
                const fromDesc = findChineseDescription(wire.fromCode, connMap);
                const toDesc = findChineseDescription(wire.toCode, connMap);

                output.push([
                    wire.wireId,
                    wire.multicoreId,
                    wire.option,
                    wire.color,
                    wire.size,
                    wire.material,
                    wire.identTag,
                    wire.fromCode,
                    wire.fromPin,
                    fromDesc,
                    wire.toCode,
                    wire.toPin,
                    toDesc
                ]);
            });

            return {
                data: output,
                total: wireList.length,
                cCount: cCount,
                sCount: sCount
            };
        }

        function findChineseDescription(code, connMap) {
            if (!code || !connMap || Object.keys(connMap).length === 0) return '';

            let trimmedCode = code.trim();

            // å°è¯•ç›´æ¥åŒ¹é…
            if (connMap[trimmedCode]) {
                return connMap[trimmedCode];
            }
            // å°è¯•å»é™¤ç©ºæ ¼åŒ¹é…
            else if (connMap[trimmedCode.replace(/\s/g, '')]) {
                return connMap[trimmedCode.replace(/\s/g, '')];
            }
            // å°è¯•å¤§å°å†™ä¸æ•æ„ŸåŒ¹é…
            else {
                const upperCode = trimmedCode.toUpperCase();
                for (const [key, value] of Object.entries(connMap)) {
                    if (key.toUpperCase() === upperCode) {
                        return value;
                    }
                }
            }

            // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²
            return '';
        }

        function displayResults(result) {
            document.getElementById('statTotal').textContent = result.total;
            document.getElementById('statC').textContent = result.cCount;
            document.getElementById('statS').textContent = result.sCount;

            // æ›´æ–°ç»Ÿè®¡æ ‡ç­¾
            document.querySelector('.stat-card:nth-child(1) .stat-label').textContent = 'å¤–è´­ä»¶å›è·¯æ€»æ•°';
            document.querySelector('.stat-card:nth-child(2) .stat-label').textContent = 'Cå¼€å¤´å›è·¯æ•°';
            document.querySelector('.stat-card:nth-child(3) .stat-label').textContent = 'Så¼€å¤´å›è·¯æ•°';

            // æ˜¾ç¤ºå®Œæ•´é¢„è§ˆè¡¨æ ¼
            const table = document.getElementById('previewTable');
            table.innerHTML = '';

            // è¡¨å¤´
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            result.data[0].forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            // æ‰€æœ‰æ•°æ®è¡Œ
            const tbody = document.createElement('tbody');
            const allRows = result.data.slice(1); // è·³è¿‡è¡¨å¤´ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ•°æ®

            allRows.forEach((row, index) => {
                const tr = document.createElement('tr');
                // äº¤æ›¿è¡ŒèƒŒæ™¯è‰²
                if (index % 2 === 0) {
                    tr.style.backgroundColor = '#f9f9f9';
                }

                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell || '';
                    // æ ¹æ®åˆ—ç´¢å¼•è®¾ç½®å¯¹é½æ–¹å¼
                    const colIndex = row.indexOf(cell);
                    if ([0, 1, 3].includes(colIndex)) { // Wire ID, Multicore ID, Color
                        td.style.textAlign = 'center';
                    } else if ([8, 11].includes(colIndex)) { // Pinåˆ—
                        td.style.textAlign = 'center';
                    } else {
                        td.style.textAlign = 'left';
                    }
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
        }

        // ä¸‹è½½Excelæ–‡ä»¶
        downloadBtn.addEventListener('click', () => {
            if (!generatedData) return;

            // åˆ›å»ºå·¥ä½œè¡¨
            const ws = XLSX.utils.aoa_to_sheet(generatedData.data);

            // è®¾ç½®åˆ—å®½
            const colWidths = [
                { wch: 16 }, // Wire ID
                { wch: 16 }, // Multicore ID
                { wch: 28 }, // Option
                { wch: 12 }, // Color
                { wch: 14 }, // Size / Gauge
                { wch: 14 }, // Material
                { wch: 14 }, // Ident Tag
                { wch: 22 }, // From Code
                { wch: 14 }, // From Pin
                { wch: 35 }, // Fromä¸­æ–‡æè¿°
                { wch: 22 }, // To Code
                { wch: 14 }, // To Pin
                { wch: 35 }  // Toä¸­æ–‡æè¿°
            ];
            ws['!cols'] = colWidths;

            // è®¾ç½®è¡Œé«˜
            ws['!rows'] = [{ hpx: 30 }, { hpx: 25 }]; // è¡¨å¤´30pxï¼Œæ•°æ®è¡Œ25px

            // è·å–æ•°æ®èŒƒå›´
            const range = XLSX.utils.decode_range(ws['!ref']);

            // ä¸ºæ¯ä¸ªå•å…ƒæ ¼æ·»åŠ æ ·å¼
            for (let R = range.s.r; R <= range.e.r; ++R) {
                for (let C = range.s.c; C <= range.e.c; ++C) {
                    const cellAddress = XLSX.utils.encode_cell({ r: R, c: C });
                    const cell = ws[cellAddress];

                    if (!cell) continue;

                    // è¡¨å¤´è¡Œæ ·å¼
                    if (R === 0) {
                        cell.s = {
                            font: {
                                name: 'å¾®è½¯é›…é»‘',
                                sz: 12,
                                bold: true,
                                color: { rgb: "FFFFFF" }
                            },
                            fill: {
                                fgColor: { rgb: "4472C4" }
                            },
                            alignment: {
                                horizontal: "center",
                                vertical: "center",
                                wrapText: true
                            },
                            border: {
                                top: { style: "thin", color: { auto: 1 } },
                                right: { style: "thin", color: { auto: 1 } },
                                bottom: { style: "thin", color: { auto: 1 } },
                                left: { style: "thin", color: { auto: 1 } }
                            }
                        };
                    }
                    // æ•°æ®è¡Œæ ·å¼
                    else {
                        const isEvenRow = (R % 2 === 0);

                        cell.s = {
                            font: {
                                name: 'å¾®è½¯é›…é»‘',
                                sz: 10
                            },
                            fill: {
                                fgColor: { rgb: isEvenRow ? "F2F2F2" : "FFFFFF" }
                            },
                            alignment: {
                                vertical: "center",
                                wrapText: false
                            },
                            border: {
                                top: { style: "thin", color: { auto: 1 } },
                                right: { style: "thin", color: { auto: 1 } },
                                bottom: { style: "thin", color: { auto: 1 } },
                                left: { style: "thin", color: { auto: 1 } }
                            }
                        };

                        // ç‰¹å®šåˆ—çš„å¯¹é½æ–¹å¼
                        // Wire ID, Multicore ID, Color - å±…ä¸­
                        if ([0, 1, 3].includes(C)) {
                            cell.s.alignment.horizontal = "center";
                        }
                        // Option, From Code, To Code, ä¸­æ–‡æè¿° - å·¦å¯¹é½
                        else if ([2, 7, 9, 10, 12].includes(C)) {
                            cell.s.alignment.horizontal = "left";
                        }
                        // Pinåˆ— - å±…ä¸­
                        else if ([8, 11].includes(C)) {
                            cell.s.alignment.horizontal = "center";
                        }
                        // å…¶ä»–åˆ— - å·¦å¯¹é½
                        else {
                            cell.s.alignment.horizontal = "left";
                        }
                    }
                }
            }

            // åˆ›å»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();

            // è®¾ç½®å·¥ä½œç°¿å±æ€§
            wb.Props = {
                Title: "å¤–è´­ä»¶æ¸…å•",
                Subject: "è‡ªåŠ¨ç”Ÿæˆçš„å¤–è´­ä»¶å›è·¯æ¸…å•",
                Author: "å¤–è´­ä»¶æ¸…å•ç”Ÿæˆå™¨",
                CreatedDate: new Date()
            };

            XLSX.utils.book_append_sheet(wb, ws, 'å¤–è´­ä»¶æ¸…å•');

            // ç”ŸæˆExcelæ–‡ä»¶
            const date = new Date().toISOString().slice(0, 10);
            XLSX.writeFile(wb, `å¤–è´­ä»¶æ¸…å•_${date}.xlsx`);
        });

        // é‡ç½®
        resetBtn.addEventListener('click', () => {
            wirelistFile.value = '';
            connlistFile.value = '';
            wirelistName.textContent = '';
            connlistName.textContent = '';
            wirelistBox.classList.remove('has-file');
            connlistBox.classList.remove('has-file');
            generateBtn.disabled = true;
            progressSection.style.display = 'none';
            resultSection.style.display = 'none';
            wirelistData = null;
            connlistData = null;
            generatedData = null;
        });
    </script>
</body>
</html>
