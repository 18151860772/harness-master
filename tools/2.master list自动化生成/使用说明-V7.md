# Master List 自动化生成工具 - V7版使用说明

## 工具简介

本工具是一个基于网页的自动化工具，用于根据Wire List和配置表自动生成Master List。工具会根据Wire List中每个Family（Ident Tag）涉及的Option组合，自动匹配配置表中各版型的打点情况，生成完整的Master List。

**V7版本新增特性：**
- ✅ 智能Sheet识别：支持不同sheet名称的自动识别
- ✅ 标准模板下载：提供Wire List和配置表的标准模板下载
- ✅ Sheet信息查看：可查看上传文件的所有sheet及识别结果

## 核心功能

### 1. 智能Sheet识别（V7新功能）
系统会自动识别正确的sheet，无需担心sheet名称不一致：

**Wire List sheet识别规则：**
1. 优先级1：精确匹配 "Wire List"
2. 优先级2：包含"wire"和"list"关键词
3. 优先级3：包含任一关键词（wire/list/wirelist/wire-list/导线/线束/接线/连接线）
4. 优先级4：使用第一个sheet

**配置表sheet识别规则：**
1. 优先级1：精确匹配 "Master List"
2. 优先级2：包含"master"和"list"关键词
3. 优先级3：包含任一关键词（master/list/masterlist/master-list/config/configuration/配置/特征值）
4. 优先级4：使用第一个sheet

### 2. 标准模板下载（V7新功能）
如果没有标准模板，可以直接从网页下载：

**Wire List模板：**
- 包含10行示例数据
- Sheet名称：Wire List
- 支持Option组合（如A01&B02）
- 列结构完整，可直接使用

**配置表模板：**
- 包含13行示例数据和5个版型
- Sheet名称：Master List
- 支持打点符号（●或X）
- 列结构完整，可直接使用

### 3. Sheet信息查看（V7新功能）
上传文件后，可以点击"查看Sheet列表"按钮：
- 查看文件中包含的所有sheet
- 显示系统识别的sheet（带✓标记）
- 确认识别结果是否正确

### 4. 按Family和版型生成零件号
- 从Wire List中提取所有Family（Ident Tag）
- 每个Family在每个版型中生成一个零件号，零件号规则是Family + 版型编号（从001开始）
- 例如：FLOOR001、FLOOR002...（FLOOR在版型1中生成FLOOR001，在版型2中生成FLOOR002）
- 根据配置表中该Family在各版型的打点情况，用X标记
- 特征值代码用●标记
- 相同Family名称在不同版型中生成不同的零件号

### 5. 智能Option解析
- 自动拆分组合Option（包含&、/、-、()等符号）
- 例如：`KP01&KB02&(LC02/LC20)&GXA` → 拆分为 KP01、KB02、LC02、LC20、GXA
- 支持&（与）、/（或）、-（非）等逻辑运算符

### 6. 版型匹配打点
- 根据Wire List中每个Family涉及的Option组合
- 匹配配置表中各版型的打点情况
- 如果某个Option组合在某个版型中打点，则对应的Family在该版型中打点

### 7. 完整的Master List格式
- 生成的格式与MasterList__202508060203859.xlsx一致
- 包含：No、Family、各版型列、所有Option列
- 打点用●表示

## 使用步骤

### 1. 打开工具

双击打开 `masterlist-generator-v7.html` 文件，在浏览器中运行。

### 2. 下载标准模板（可选）

如果是第一次使用或需要标准格式，可以：

1. 点击"下载Wire List模板"按钮
2. 点击"下载配置表模板"按钮
3. 系统会弹出详细的使用说明
4. 根据模板填写实际数据

**Wire List模板说明：**
- 第5列：Option（支持组合，如A01&B02）
- 第7列：Family（用于分组）
- 其他列：可根据实际需要填写

**配置表模板说明：**
- 第1列：特征值代码（Option代码）
- 第2列：特征值描述（Option名称）
- 第3列：备注
- 第4列及以后：各版型的打点（●或X表示该版型包含此Option）

### 3. 上传文件

工具提供两个文件上传区域：

- **Wire List上传区**：点击或拖拽上传Wire List文件（.xlsx或.xls格式）
- **配置表上传区**：点击或拖拽上传配置表文件（.xlsx或.xls格式）

上传成功后，会显示：
- 文件名（绿色背景）
- 识别的Sheet名称（蓝色背景）

**V7智能识别特性：**
- 系统会自动识别正确的sheet
- 无论sheet名称是"Wire List"、"WireList"还是其他名称，都能正确识别
- 无需修改sheet名称

### 4. 查看Sheet列表（可选）

两个文件都上传后，"查看Sheet列表"按钮变为可用状态。点击该按钮可以：

- 查看Wire List文件的所有sheet列表
- 查看配置表文件的所有sheet列表
- 系统识别的sheet会显示✓标记
- 确认识别结果是否符合预期

### 5. 开始处理

两个文件都上传完成后，"开始处理"按钮将变为可用状态。点击该按钮开始处理数据。

处理过程中会显示进度条和处理状态，包括：
- 解析Wire List（显示识别的sheet名称）
- 解析配置表（显示识别的sheet名称）
- 分析Wire List数据
- 生成Option组合
- 匹配版型打点
- 生成结果表格

### 6. 查看结果

处理完成后，会显示以下信息：

#### 统计数据
- Family总数：Wire List中不同的Family数量
- 版型总数：配置表中版型的数量
- Option总数：从Wire List中解析出的Option总数
- 打点总数：所有Family在所有版型中的打点总数
- 总行数：生成的Master List总行数

#### 结果表格
表格包含以下列：
- **No**：序号
- **零件号**：零件号（Family + 版型编号）
- **Family**：Family名称（从Wire List中抓取）
- **各版型列**：显示每个零件号在各版型中的打点情况（X表示打点）
- **各Option列**：显示每个零件号涉及哪些Option（●表示涉及）

#### 筛选功能
- **Family筛选**：输入Family关键字，实时筛选表格
- **版型筛选**：选择特定的版型，只显示在该版型中打点的Family

#### 处理日志
显示处理过程中的详细日志信息，包括：
- 文件加载状态
- Sheet识别过程（V7新特性）
- 数据解析进度
- Option组合生成情况
- 匹配结果统计
- 错误和警告信息

### 7. 导出结果

点击"导出结果"按钮，将处理结果导出为Excel文件。导出的文件：
- 文件名格式：`MasterList__YYYYMMDDHHMMSS.xlsx`
- 包含完整的Master List表格
- 格式与MasterList__202508060203859.xlsx一致

### 8. 复制到HTML（保留颜色）

点击"复制到HTML（保留颜色）"按钮，可以将结果表格复制到剪贴板：
- 保留所有颜色格式
- 可以直接粘贴到Word或Excel中
- 便于制作报告或文档

### 9. 导出Family-Option关系

点击"导出Family-Option关系"按钮，导出所有Family与Option的关系表。导出的文件：
- 文件名格式：`FamilyOptionRelation__YYYYMMDDHHMMSS.xlsx`
- 包含以下列：
  - No：序号
  - Family：Family名称
  - Option组合：该Family涉及的所有Option组合（用、分隔）
  - 涉及的Option：该Family涉及的所有Option（用|分隔，便于程序处理）
- 示例：
  - FLOOR：KP01、KB02、LC02、LC20、GXA
  - IP：EP01、KG01、KQ00

### 10. 导出Option-Family关系

点击"导出Option-Family关系"按钮，导出所有Option与Family的关系表。导出的文件：
- 文件名格式：`OptionFamilyRelation__YYYYMMDDHHMMSS.xlsx`
- 包含以下列：
  - No：序号
  - Option：Option名称
  - 涉及的Family：该Option涉及的所有Family（用、分隔）
- 示例：
  - KP01：FLOOR、IP、DOOR
  - KB02：FLOOR

## 数据格式要求

### Wire List格式

Wire List文件应包含以下列：
- Wire ID：线束编号
- Color：颜色
- Size / Gauge：线径
- Material：材质
- Option：配置选项（支持组合Option）
- Multicore ID：多芯线编号
- Ident Tag：识别标签（用于生成Family）
- From：起点
- To：终点

### 配置表格式

配置表文件应包含以下结构：
- 第1行：空行
- 第2行：版型名称（从第4列开始）
- 第3行及以后：Family数据
  - 第1列：Family编号（对应Wire List中的Option）
  - 第2列：Family名称
  - 第3列：备注
  - 第4列及以后：各版型的打点情况（X或其他标记表示打点）

## Family-Option关系说明

工具会自动从Wire List中提取每个Family涉及的所有Option，并生成Family-Option关系表。

**示例：**

假设Wire List中FLOOR Family涉及以下Option组合：
- `KP01&KB02&(LC02/LC20)&GXA`

工具会将其完全拆分为：
- KP01
- KB02
- LC02
- LC20
- GXA

另一个例子：`-(NN11&KP01)`
- 工具会将其拆分为：NN11、KP01（去掉-号）

导出的Family-Option关系表中，FLOOR对应的Option组合为：
- Option组合列：KP01、KB02、LC02、LC20、GXA
- 涉及的Option列：KP01|KB02|LC02|LC20|GXA

这意味着FLOOR与KP01、KB02、LC02、LC20、GXA相关。

## Option解析规则

工具会按照 `&`、`()`、`/`、`-`、`，`、`,` 完全拆分Option，并去掉所有括号：

1. **&连接**：`KP01&KB02&GXA` → 拆分为 KP01、KB02、GXA
2. **括号内/连接**：`(LC02/LC20)` → 拆分为 LC02、LC20（去掉括号，按/拆分）
3. **括号内逗号连接**：`(CN01，RN03)` 或 `(CN01,RN03)` → 拆分为 CN01、RN03（去掉括号，按逗号拆分）
4. **中文括号**：`（CN01，RN03）` → 拆分为 CN01、RN03（去掉中文括号，按逗号拆分）
5. **负号开头**：`-S600` → 拆分为 S600（去掉-号）
6. **组合使用**：`KP01&KB02&(LC02/LC20)&GXA` → 拆分为 KP01、KB02、LC02、LC20、GXA
7. **负号组合**：`-(NN11&KP01)` → 拆分为 NN11、KP01（去掉-号，按&拆分）
8. **完全拆分**：所有符号（包括中文逗号、英文逗号、中文括号、英文括号）都会被处理，确保每个Option都被独立提取，且不会残留任何括号

## 版型匹配逻辑

工具会为每种Option组合生成一行数据，并匹配版型打点：

1. **提取Family涉及的Option**：从Wire List中提取该Family涉及的所有Option
2. **遍历所有版型**：对每个版型，检查哪些Option在该版型中打点
3. **识别Option组合**：识别出独特的Option组合
4. **匹配版型打点**：如果某个Option组合在某个版型中打点，则对应的Family在该版型中打点
5. **汇总相同组合**：不同版型的相同Family的相同Option打点组合关系一致的，汇总到一行

## 输出格式说明

生成的Master List文件格式与MasterList__202508060203859.xlsx一致：

### 表头
- **No**：序号
- **Family**：Family名称（从Wire List中抓取）
- **版型列**：配置表中的所有版型（如T28F4J20+840AHA...等）
- **Option列**：Wire List中涉及的所有Option（如EP01、QR02、KG01等）

### 数据行
- 每行代表一个Family的一个零件号
- 版型列中X表示该零件号在该版型中打点
- Option列中●表示该零件号涉及该Option

### A处：零件号
- 从Wire List中抓取所有Family
- 每个Family在每个版型中生成一个零件号（Family + 版型编号）
- 相同Family名称在不同版型中生成不同的零件号

### B处：版型
- 从配置表中抓取（完全复制过来即可）

### C处：使用的Option
- 从Wire List中抓取
- 以Wire List中所有使用到的Option为主
- 不需要体现配置表中未在Wire List中使用到的冗余Option
- 每个零件号涉及的Option是该Family涉及的所有Option

### D处：打点
- 为每个版型所需要的零件号打点
- 配置表中版型涉及的Option打点和Wire List中Family里涉及的Option有交集，即打点此零件号
- 每个零件号只在其对应的版型中显示X
- 打点关系与配置表中版型与Option打点完全一致

### E处：打点关系
- 需要与配置表中版型与Option打点完全一致

## V7版本新特性详解

### 1. 智能Sheet识别

**问题背景：**
- 不同项目的文件可能使用不同的sheet名称
- 修改sheet名称比较麻烦
- 容易因为sheet名称不匹配导致错误

**解决方案：**
V7版本实现了多级sheet识别策略：

**Wire List识别关键词：**
- wire, list, wirelist, wire-list
- 导线, 线束, 接线, 连接线

**配置表识别关键词：**
- master, list, masterlist, master-list
- config, configuration
- 配置, 特征值

**识别优先级：**
1. 精确匹配（如"Wire List"）
2. 组合关键词匹配（如包含"wire"和"list"）
3. 单一关键词匹配（如包含"wire"）
4. 兜底方案（使用第一个sheet）

**使用示例：**
```
文件包含 3 个sheet: Sheet1, WireList数据, 备份数据
通过关键词匹配找到Wire List sheet: "WireList数据"

文件包含 2 个sheet: 配置表v2, Sheet2
通过任一关键词匹配找到配置表sheet: "配置表v2"
```

### 2. 标准模板下载

**功能说明：**
提供两个标准模板，用户可以直接下载使用：
- Wire List模板：包含完整列结构和示例数据
- 配置表模板：包含完整格式和示例数据

**模板特点：**
- 列宽已优化
- 包含示例数据便于理解
- Sheet名称符合识别规则
- 下载后弹出详细使用说明

**使用场景：**
1. 新项目开始时，下载标准模板
2. 按照模板格式准备数据
3. 避免格式错误

### 3. Sheet信息查看

**功能说明：**
上传文件后，可以查看所有sheet和识别结果：
- 显示文件中所有sheet列表
- 标记系统识别的sheet（✓）
- 方便确认识别是否正确

**使用场景：**
1. 确认文件结构
2. 验证识别结果
3. 排查sheet相关问题

## 注意事项

1. **文件格式**：确保上传的文件是.xlsx或.xls格式
2. **Sheet名称**：V7版本支持多种sheet名称，系统会自动识别
3. **数据完整性**：确保Wire List和配置表的数据完整且格式正确
4. **Family一致性**：确保Wire List中的Ident Tag格式统一
5. **浏览器兼容性**：建议使用Chrome、Edge或Firefox等现代浏览器
6. **文件大小**：大文件处理可能需要较长时间，请耐心等待
7. **模板下载**：如果是第一次使用，建议先下载标准模板作为参考

## 常见问题

### Q: 上传文件后没有反应？
A: 请检查文件格式是否正确（.xlsx或.xls），并确保文件没有损坏。

### Q: 处理过程中出现错误？
A: 请查看处理日志中的错误信息，检查数据格式是否符合要求。

### Q: 导出的结果不完整？
A: 请检查原始数据是否完整，特别是Ident Tag和Option列是否有空值。

### Q: 筛选功能没有效果？
A: 请确保输入的Family名称或选择的版型正确，区分大小写。

### Q: Sheet名称不是标准名称怎么办？
A: V7版本支持智能Sheet识别，无论sheet名称是什么，系统都会自动识别正确的sheet。

### Q: 如何确认系统识别的sheet是否正确？
A: 上传文件后，点击"查看Sheet列表"按钮，可以看到所有sheet和识别结果。

### Q: 从哪里下载标准模板？
A: 在网页中间的"下载标准模板"区域，点击对应的下载按钮即可。

### Q: Family生成不符合预期？
A: 请检查Wire List中的Ident Tag格式和Option组合，工具会根据Option组合自动生成Family行。

### Q: 为什么同一个Family有多行？
A: 因为同一个Family可能有多种不同的Option组合，每种独特的Option组合会生成一行数据。例如，FLOOR可能有多行，每行对应不同的Option组合。

### Q: 相同Family的相同Option组合为什么汇总到一行？
A: 为了避免重复数据，提高数据可读性，不同版型的相同Family的相同Option打点组合关系一致的，会汇总到一行。

### Q: Family-Option关系表有什么用？
A: Family-Option关系表展示了每个Family涉及的所有Option，可以帮助理解Family与Option的对应关系，便于数据分析和验证。

### Q: V7版本与之前版本有什么区别？
A: V7版本新增了智能Sheet识别、标准模板下载和Sheet信息查看功能，使用更加方便灵活。

### Q: 如果sheet名称完全不匹配怎么办？
A: 系统会使用第一个sheet作为兜底方案，同时会显示警告信息。

### Q: 如何使用下载的模板？
A: 下载后会弹出详细的使用说明，按照说明填写数据即可。模板已包含示例数据供参考。

## 技术支持

如遇到问题或需要帮助，请查看处理日志中的详细信息，或联系技术支持。

## 更新日志

### V7版本 (2026-01-05)
- **新增**：智能Sheet识别功能，支持多种sheet名称
- **新增**：标准模板下载功能，提供Wire List和配置表模板
- **新增**：Sheet信息查看功能，可查看所有sheet和识别结果
- **新增**：上传后显示识别的sheet名称
- **优化**：日志系统，增加info类型日志
- **优化**：用户界面，新增模板下载区域
- **改进**：sheet识别的优先级逻辑
- **改进**：错误提示和警告信息

### 新版 (2025-01-04)
- **核心功能改进**：按Family和Option组合生成Master List
- **新增**：自动识别不同的Option组合
- **新增**：相同Family的相同Option组合汇总功能
- **优化**：版型匹配逻辑，确保每个Family正确匹配对应的版型
- **优化**：生成格式完全符合MasterList__202508060203859.xlsx
- **新增**：详细的Option组合分析日志
- **优化**：改进用户界面和交互体验
- **新增**：Family-Option关系导出功能
- **新增**：Family和版型筛选功能
