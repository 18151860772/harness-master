<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工具箱 - 线束大师</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/tools-page.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 网站锁定屏幕 -->
    <div class="lock-screen" id="lockScreen">
        <div class="lock-content">
            <div class="lock-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h2 class="lock-title">请先登录</h2>
            <p class="lock-message">需要登录后才能访问此网站</p>

            <!-- 锁定屏幕登录表单 -->
            <div class="lock-login-form">
                <div class="form-group">
                    <label>邮箱</label>
                    <input type="email" id="lockLoginEmail" placeholder="请输入邮箱">
                </div>
                <div class="form-group">
                    <label>密码</label>
                    <input type="password" id="lockLoginPassword" placeholder="请输入密码">
                </div>
                <button class="btn-primary btn-full" onclick="handleLockLogin()">
                    <i class="fas fa-sign-in-alt"></i>
                    登录
                </button>
            </div>

            <div class="lock-footer">
                <p>联系管理员: admin@harness.com</p>
            </div>
        </div>
    </div>

    <!-- 遮罩层 -->
    <div class="overlay-mask" id="overlayMask" onclick="closeAllPanels()"></div>

    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <a href="index.html" class="logo-link">
                    <div class="logo-icon">
                        <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="20" cy="20" r="18" stroke="url(#logoGradient)" stroke-width="2"/>
                            <path d="M12 20h16M20 12v16" stroke="url(#logoGradient)" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="20" cy="20" r="6" stroke="url(#logoGradient)" stroke-width="2" fill="none"/>
                            <circle cx="20" cy="8" r="2" fill="#00d4ff"/>
                            <circle cx="20" cy="32" r="2" fill="#00d4ff"/>
                            <circle cx="8" cy="20" r="2" fill="#00d4ff"/>
                            <circle cx="32" cy="20" r="2" fill="#00d4ff"/>
                            <defs>
                                <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#00d4ff"/>
                                    <stop offset="100%" style="stop-color:#8b5cf6"/>
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>
                    <span class="logo-text">线束大师</span>
                    <span class="logo-subtitle">Harness Master</span>
                </a>
            </div>
            
            <ul class="nav-links">
                <li><a href="index.html#home">首页</a></li>
                <li><a href="index.html#tools" class="active">工具箱</a></li>
                <li><a href="index.html#requirements">需求提交</a></li>
                <li><a href="index.html#community">社区</a></li>
                <li><a href="index.html#docs">文档</a></li>
            </ul>
            
            <div class="nav-actions">
                <!-- 语言切换 -->
                <button class="btn-icon" id="langToggle" title="切换语言" onclick="toggleLangPanel()">
                    <i class="fas fa-globe"></i>
                </button>

                <!-- 主题切换按钮 -->
                <button class="btn-icon theme-toggle" id="themeToggle" title="切换主题">
                    <i class="fas fa-moon"></i>
                </button>

                <button class="btn-icon" title="消息通知">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </button>

                <!-- 设置按钮 -->
                <div class="settings-wrapper">
                    <button class="btn-icon" id="settingsBtn" title="设置">
                        <i class="fas fa-cog"></i>
                    </button>
                    <!-- 设置面板 -->
                    <div class="settings-panel" id="settingsPanel">
                        <!-- 设置面板头部 -->
                        <div class="settings-panel-header">
                            <div class="header-left">
                                <button class="header-btn" onclick="closeSettingsPanel(event)" title="返回">
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                                <span>系统设置</span>
                            </div>
                            <button class="close-btn" onclick="closeSettingsPanel(event)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <!-- 账户信息 -->
                        <div class="settings-item account-item" id="accountSection" onclick="toggleAccountPanel()">
                            <div class="account-info">
                                <div class="account-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="account-details">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span class="account-name" id="accountName">未登录</span>
                                        <span class="login-status not-logged-in" id="loginStatus">未登录</span>
                                    </div>
                                    <span class="account-email" id="accountEmail">点击登录账户</span>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <!-- 退出登录按钮 -->
                            <button class="logout-btn" id="logoutBtn" onclick="event.stopPropagation(); handleLogout()" style="display: none;">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>退出</span>
                            </button>
                        </div>

                        <!-- 账户面板 -->
                        <div class="account-panel" id="accountPanel">
                            <div class="account-panel-header">
                                <button class="back-btn" onclick="toggleAccountPanel()">
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                                <span>账户管理</span>
                            </div>

                            <!-- 登录表单 -->
                            <div id="loginForm" class="account-form">
                                <div class="form-group">
                                    <label>邮箱</label>
                                    <input type="email" id="loginEmail" placeholder="请输入邮箱">
                                </div>
                                <div class="form-group">
                                    <label>密码</label>
                                    <input type="password" id="loginPassword" placeholder="请输入密码">
                                </div>
                                <button class="btn-primary btn-full" onclick="handleLogin()">
                                    <i class="fas fa-sign-in-alt"></i>
                                    登录
                                </button>
                                <div class="form-footer">
                                    <a href="#" onclick="showRegisterForm(); return false;">注册新账户</a>
                                </div>
                            </div>

                            <!-- 注册表单 -->
                            <div id="registerForm" class="account-form" style="display: none;">
                                <div class="form-group">
                                    <label>用户名</label>
                                    <input type="text" id="regUsername" placeholder="请输入用户名">
                                </div>
                                <div class="form-group">
                                    <label>邮箱</label>
                                    <input type="email" id="regEmail" placeholder="请输入邮箱">
                                </div>
                                <div class="form-group">
                                    <label>密码</label>
                                    <input type="password" id="regPassword" placeholder="请输入密码">
                                </div>
                                <div class="form-group">
                                    <label>确认密码</label>
                                    <input type="password" id="regPasswordConfirm" placeholder="请再次输入密码">
                                </div>
                                <button class="btn-primary btn-full" onclick="handleRegister()">
                                    <i class="fas fa-user-plus"></i>
                                    注册
                                </button>
                                <div class="form-footer">
                                    <a href="#" onclick="showLoginForm(); return false;">已有账户？去登录</a>
                                </div>
                            </div>

                            <!-- 已登录状态 -->
                            <div id="loggedInPanel" class="loggedin-panel" style="display: none;">
                                <div class="user-info">
                                    <div class="user-avatar-large">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="user-details">
                                        <span class="user-name" id="userName">用户名</span>
                                        <span class="user-email" id="userEmail">email@example.com</span>
                                    </div>
                                </div>
                                <div class="user-menu">
                                    <button class="menu-item" onclick="showChangePassword()">
                                        <i class="fas fa-key"></i>
                                        <span>修改密码</span>
                                    </button>
                                    <button class="menu-item" onclick="showChangeEmail()">
                                        <i class="fas fa-envelope"></i>
                                        <span>修改邮箱</span>
                                    </button>
                                    <button class="menu-item" id="adminMenuItem" onclick="showUserManagement()" style="display: none;">
                                        <i class="fas fa-users-cog"></i>
                                        <span>用户管理</span>
                                    </button>
                                    <button class="menu-item danger" onclick="handleLogout()">
                                        <i class="fas fa-sign-out-alt"></i>
                                        <span>退出登录</span>
                                    </button>
                                </div>
                            </div>

                            <!-- 修改密码表单 -->
                            <div id="changePasswordForm" class="account-form" style="display: none;">
                                <div class="form-group">
                                    <label>当前密码</label>
                                    <input type="password" id="currentPassword" placeholder="请输入当前密码">
                                </div>
                                <div class="form-group">
                                    <label>新密码</label>
                                    <input type="password" id="newPassword" placeholder="请输入新密码">
                                </div>
                                <div class="form-group">
                                    <label>确认新密码</label>
                                    <input type="password" id="confirmNewPassword" placeholder="请再次输入新密码">
                                </div>
                                <button class="btn-primary btn-full" onclick="handleChangePassword()">
                                    <i class="fas fa-save"></i>
                                    保存修改
                                </button>
                            </div>

                            <!-- 用户管理面板 -->
                            <div id="userManagementPanel" class="user-management-panel" style="display: none;">
                                <div class="account-panel-header">
                                    <button class="back-btn" onclick="backToUserPanel()">
                                        <i class="fas fa-arrow-left"></i>
                                    </button>
                                    <span>用户管理</span>
                                    <button class="btn-icon-sm add-user-btn" onclick="showAddUserForm()" title="新增用户">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>

                                <!-- 新增用户表单 -->
                                <div id="addUserForm" class="add-user-form" style="display: none;">
                                    <div class="form-header-inline">
                                        <button class="back-btn-inline" onclick="hideAddUserForm()">
                                            <i class="fas fa-arrow-left"></i>
                                        </button>
                                        <span>新增用户</span>
                                    </div>
                                    <div class="form-group">
                                        <label>用户名</label>
                                        <input type="text" id="addUserUsername" placeholder="请输入用户名" required>
                                    </div>
                                    <div class="form-group">
                                        <label>邮箱</label>
                                        <input type="email" id="addUserEmail" placeholder="请输入邮箱" required>
                                    </div>
                                    <div class="form-group">
                                        <label>密码</label>
                                        <input type="password" id="addUserPassword" placeholder="请输入密码" required>
                                    </div>
                                    <div class="form-group">
                                        <label>用户角色</label>
                                        <select id="addUserRole">
                                            <option value="user">普通用户</option>
                                            <option value="admin">管理员</option>
                                        </select>
                                    </div>
                                    <div class="form-actions">
                                        <button class="btn-secondary" onclick="hideAddUserForm()">返回</button>
                                        <button class="btn-primary" onclick="handleAddUser()">创建用户</button>
                                    </div>
                                </div>

                                <!-- 修改密码表单 -->
                                <div id="changeUserPasswordForm" class="add-user-form" style="display: none;">
                                    <div class="form-header-inline">
                                        <button class="back-btn-inline" onclick="hideChangeUserPasswordForm()">
                                            <i class="fas fa-arrow-left"></i>
                                        </button>
                                        <span>修改密码</span>
                                    </div>
                                    <div class="form-header">
                                        <p id="changePasswordUserEmail" class="user-email-display"></p>
                                    </div>
                                    <div class="form-group">
                                        <label>新密码</label>
                                        <input type="password" id="newUserPassword" placeholder="请输入新密码" required>
                                    </div>
                                    <div class="form-group">
                                        <label>确认密码</label>
                                        <input type="password" id="confirmNewUserPassword" placeholder="请再次输入新密码" required>
                                    </div>
                                    <div class="form-actions">
                                        <button class="btn-secondary" onclick="hideChangeUserPasswordForm()">返回</button>
                                        <button class="btn-primary" onclick="handleChangeUserPassword()">保存密码</button>
                                    </div>
                                </div>

                                <div class="user-list-container" id="userListContainer">
                                    <!-- 用户列表将动态生成 -->
                                </div>
                            </div>
                        </div>

                        <div class="settings-divider"></div>

                        <div class="settings-item">
                            <div class="settings-label">
                                <i class="fas fa-moon"></i>
                                <span data-i18n="theme">主题模式</span>
                            </div>
                            <div class="settings-control theme-switch">
                                <button class="theme-option active" data-theme="dark" onclick="switchTheme('dark')">
                                    <i class="fas fa-moon"></i>
                                    <span data-i18n="darkMode">暗黑</span>
                                </button>
                                <button class="theme-option" data-theme="light" onclick="switchTheme('light')">
                                    <i class="fas fa-sun"></i>
                                    <span data-i18n="lightMode">明亮</span>
                                </button>
                            </div>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-item">
                            <div class="settings-label">
                                <i class="fas fa-language"></i>
                                <span data-i18n="language">语言</span>
                            </div>
                            <div class="settings-control lang-switch">
                                <button class="lang-option active" data-lang="zh" onclick="switchLang('zh')">
                                    <span>中文</span>
                                </button>
                                <button class="lang-option" data-lang="en" onclick="switchLang('en')">
                                    <span>English</span>
                                </button>
                            </div>
                        </div>
                        <div class="settings-divider"></div>

                        <!-- 底部退出按钮 -->
                        <div class="settings-item logout-item" id="footerLogoutSection" style="display: none;">
                            <button class="btn-logout-full" onclick="handleLogout()">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>退出登录</span>
                            </button>
                        </div>

                        <div class="settings-footer">
                            <span class="version">v2.1.0</span>
                        </div>
                    </div>
                </div>

                <button class="btn-primary" id="loginBtn" onclick="openSettingsAndLogin()">
                    <i class="fas fa-user"></i>
                    <span data-i18n="login">登录</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- 主要内容区 -->
    <main class="main-content tools-page">
        <!-- 工具箱头部 -->
        <section class="tools-header">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-tools"></i>
                    专业工具箱
                </h2>
                <p class="section-description">
                    集成多种专业线束设计工具，支持自动扫描Tools文件夹中的所有工具
                </p>
            </div>
            
            <!-- 搜索和筛选 -->
            <div class="tools-controls">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="toolsSearch" placeholder="搜索工具...">
                </div>
                
                <div class="category-filters" id="categoryFilters">
                    <!-- 分类筛选将由JS动态生成 -->
                </div>
                
                <div class="tools-actions">
                    <button class="btn-secondary" onclick="scanForTools()">
                        <i class="fas fa-sync-alt"></i>
                        扫描工具
                    </button>
                    <button class="btn-secondary" onclick="exportToolsConfig()">
                        <i class="fas fa-file-export"></i>
                        导出配置
                    </button>
                </div>
            </div>
        </section>
        
        <!-- 工具网格 -->
        <section class="tools-section">
            <div class="tools-grid" id="toolsGrid">
                <!-- 工具卡片将由JS动态生成 -->
            </div>
            
            <!-- 加载指示器 -->
            <div class="loading-indicator" id="loadingIndicator">
                <i class="fas fa-spinner fa-spin"></i>
                <p>正在加载工具...</p>
            </div>
        </section>
    </main>

    <!-- 工具工作区 -->
    <div class="tool-workspace" id="toolWorkspace">
        <div class="workspace-header">
            <div class="workspace-title">
                <i class="fas fa-th-large"></i>
                <span id="currentToolName">工具工作区</span>
            </div>
            <div class="workspace-actions">
                <button class="btn-icon workspace-btn" id="fullscreenBtn" onclick="toggleFullscreen()" title="全屏 (Ctrl+F)">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="btn-icon workspace-btn" onclick="closeTool()" title="关闭 (Esc)">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="workspace-content" id="toolContent">
            <div class="placeholder-content">
                <i class="fas fa-magic"></i>
                <p>选择一个工具开始使用</p>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-bottom">
                <p>&copy; 2026 线束大师. 保留所有权利.</p>
                <div class="footer-links">
                    <a href="#">隐私政策</a>
                    <a href="#">服务条款</a>
                    <a href="#">法律声明</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Toast 通知 -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="js/tools-loader.js"></script>
</body>
</html>